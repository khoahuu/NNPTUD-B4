<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products Store</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: #2c3e50; color: white; padding: 20px; text-align: center; margin-bottom: 30px; }
        .filters { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .filter-row { display: flex; gap: 15px; align-items: end; flex-wrap: wrap; }
        .filter-group { display: flex; flex-direction: column; }
        .filter-group label { margin-bottom: 5px; font-weight: bold; }
        .filter-group input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .btn { padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn:hover { background: #2980b9; }
        .btn-clear { background: #95a5a6; }
        .btn-clear:hover { background: #7f8c8d; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .product-card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .product-card:hover { transform: translateY(-2px); }
        .product-image { width: 100%; height: 200px; object-fit: cover; }
        .product-info { padding: 15px; }
        .product-title { font-size: 16px; font-weight: bold; margin-bottom: 8px; color: #2c3e50; }
        .product-price { font-size: 18px; color: #e74c3c; font-weight: bold; margin-bottom: 8px; }
        .product-category { background: #ecf0f1; padding: 4px 8px; border-radius: 12px; font-size: 12px; color: #7f8c8d; display: inline-block; }
        .loading { text-align: center; padding: 40px; }
        .error { background: #e74c3c; color: white; padding: 15px; border-radius: 4px; margin: 20px 0; }
        .no-results { text-align: center; padding: 40px; color: #7f8c8d; }
        .pagination-controls { background: white; padding: 20px; border-radius: 8px; margin-top: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .pagination-row { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .page-size { display: flex; align-items: center; gap: 10px; }
        .page-size select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .pagination { display: flex; gap: 5px; align-items: center; }
        .page-btn { padding: 8px 12px; background: #ecf0f1; border: 1px solid #bdc3c7; border-radius: 4px; cursor: pointer; }
        .page-btn:hover { background: #d5dbdb; }
        .page-btn.active { background: #3498db; color: white; }
        .page-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .page-info { color: #7f8c8d; font-size: 14px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Products Store</h1>
        <p>Browse our collection of products</p>
    </div>
    
    <div class="container">
        <div class="filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label>Search by Title:</label>
                    <input type="text" id="titleInput" placeholder="Enter product title...">
                </div>
                <div class="filter-group">
                    <label>Min Price:</label>
                    <input type="number" id="minPriceInput" placeholder="0">
                </div>
                <div class="filter-group">
                    <label>Max Price:</label>
                    <input type="number" id="maxPriceInput" placeholder="1000">
                </div>
                <div class="filter-group">
                    <label>Slug:</label>
                    <input type="text" id="slugInput" placeholder="Enter exact slug...">
                </div>
                <div class="filter-group">
                    <label>Product ID:</label>
                    <input type="number" id="productIdInput" placeholder="Enter ID...">
                </div>
                <div class="filter-group">
                    <button class="btn" onclick="searchProducts()">Search</button>
                    <button class="btn btn-clear" onclick="clearFilters()">Clear</button>
                </div>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">Loading...</div>
        <div id="error" class="error" style="display: none;"></div>
        <div id="products" class="products-grid"></div>
        
        <div id="pagination" class="pagination-controls" style="display: none;">
            <div class="pagination-row">
                <div class="page-size">
                    <label>Show:</label>
                    <select id="pageSizeSelect" onchange="changePageSize()">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="50">50</option>
                    </select>
                    <span>products per page</span>
                </div>
                <div class="page-info" id="pageInfo"></div>
                <div class="pagination" id="paginationButtons"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api/v1/products';
        let allProducts = [];
        let filteredProducts = [];
        let currentPage = 1;
        let pageSize = 20;
        
        // Load all products on page load
        window.onload = () => getAllProducts();
        
        async function getAllProducts() {
            showLoading();
            try {
                const response = await fetch(API_BASE);
                const data = await response.json();
                allProducts = data;
                filteredProducts = data;
                currentPage = 1;
                displayProductsWithPagination();
            } catch (error) {
                showError('Failed to load products: ' + error.message);
            }
        }
        
        async function searchProducts() {
            const title = document.getElementById('titleInput').value;
            const minPrice = document.getElementById('minPriceInput').value;
            const maxPrice = document.getElementById('maxPriceInput').value;
            const slug = document.getElementById('slugInput').value;
            const productId = document.getElementById('productIdInput').value;
            
            showLoading();
            
            try {
                let url = API_BASE;
                
                // If searching by ID, use different endpoint
                if (productId) {
                    url += `/${productId}`;
                    const response = await fetch(url);
                    const data = await response.json();
                    allProducts = [data];
                    filteredProducts = [data];
                    currentPage = 1;
                    displayProductsWithPagination();
                    return;
                }
                
                // Build query parameters
                const params = new URLSearchParams();
                if (title) params.append('title', title);
                if (minPrice) params.append('minPrice', minPrice);
                if (maxPrice) params.append('maxPrice', maxPrice);
                if (slug) params.append('slug', slug);
                
                if (params.toString()) {
                    url += '?' + params.toString();
                }
                
                console.log('Calling URL:', url);
                const response = await fetch(url);
                const data = await response.json();
                allProducts = data;
                filteredProducts = data;
                currentPage = 1;
                displayProductsWithPagination();
            } catch (error) {
                showError('Search failed: ' + error.message);
            }
        }
        
        function displayProductsWithPagination() {
            hideLoading();
            hideError();
            
            if (!filteredProducts || filteredProducts.length === 0) {
                document.getElementById('products').innerHTML = '<div class="no-results">No products found</div>';
                document.getElementById('pagination').style.display = 'none';
                return;
            }
            
            const totalProducts = filteredProducts.length;
            const totalPages = Math.ceil(totalProducts / pageSize);
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const productsToShow = filteredProducts.slice(startIndex, endIndex);
            
            displayProducts(productsToShow);
            updatePagination(totalProducts, totalPages);
        }
        
        function displayProducts(products) {
            const container = document.getElementById('products');
            container.innerHTML = products.map(product => `
                <div class="product-card">
                    <img src="${product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/300x200?text=No+Image'}" alt="${product.title}" class="product-image" onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
                    <div class="product-info">
                        <div class="product-title">${product.title}</div>
                        <div class="product-price">$${product.price}</div>
                        <div class="product-category">${product.category ? product.category.name : 'No Category'}</div>
                    </div>
                </div>
            `).join('');
        }
        
        function updatePagination(totalProducts, totalPages) {
            const paginationDiv = document.getElementById('pagination');
            const pageInfoDiv = document.getElementById('pageInfo');
            const buttonsDiv = document.getElementById('paginationButtons');
            
            if (totalPages <= 1) {
                paginationDiv.style.display = 'none';
                return;
            }
            
            paginationDiv.style.display = 'block';
            
            const startItem = (currentPage - 1) * pageSize + 1;
            const endItem = Math.min(currentPage * pageSize, totalProducts);
            pageInfoDiv.textContent = `Showing ${startItem}-${endItem} of ${totalProducts} products`;
            
            let buttonsHTML = '';
            
            // Previous button
            buttonsHTML += `<button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} onclick="goToPage(${currentPage - 1})">‹</button>`;
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    buttonsHTML += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    buttonsHTML += '<span class="page-btn">...</span>';
                }
            }
            
            // Next button
            buttonsHTML += `<button class="page-btn" ${currentPage === totalPages ? 'disabled' : ''} onclick="goToPage(${currentPage + 1})">›</button>`;
            
            buttonsDiv.innerHTML = buttonsHTML;
        }
        
        function goToPage(page) {
            currentPage = page;
            displayProductsWithPagination();
        }
        
        function changePageSize() {
            pageSize = parseInt(document.getElementById('pageSizeSelect').value);
            currentPage = 1;
            displayProductsWithPagination();
        }
        function clearFilters() {
            document.getElementById('titleInput').value = '';
            document.getElementById('minPriceInput').value = '';
            document.getElementById('maxPriceInput').value = '';
            document.getElementById('slugInput').value = '';
            document.getElementById('productIdInput').value = '';
            currentPage = 1;
            getAllProducts();
        }
        
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('products').style.display = 'none';
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('products').style.display = 'grid';
        }
        
        function showError(message) {
            hideLoading();
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }
        
        function hideError() {
            document.getElementById('error').style.display = 'none';
        }
        
        // Allow Enter key to trigger search
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchProducts();
            }
        });
    </script>
</body>
</html>